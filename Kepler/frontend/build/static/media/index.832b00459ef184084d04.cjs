"use strict";var __defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__getOwnPropNames=Object.getOwnPropertyNames,__hasOwnProp=Object.prototype.hasOwnProperty,__export=(e,r)=>{for(var t in r)__defProp(e,t,{get:r[t],enumerable:!0})},__copyProps=(e,r,t,o)=>{if(r&&"object"===typeof r||"function"===typeof r)for(let n of __getOwnPropNames(r))__hasOwnProp.call(e,n)||n===t||__defProp(e,n,{get:()=>r[n],enumerable:!(o=__getOwnPropDesc(r,n))||o.enumerable});return e},__toCommonJS=e=>__copyProps(__defProp({},"__esModule",{value:!0}),e),src_exports={};__export(src_exports,{JSONLoader:()=>import_loader_utils17.JSONLoader,NullLoader:()=>NullLoader,NullWorkerLoader:()=>NullWorkerLoader,RequestScheduler:()=>import_loader_utils16.RequestScheduler,_BrowserFileSystem:()=>BrowserFileSystem,_fetchProgress:()=>fetchProgress,_unregisterLoaders:()=>_unregisterLoaders,assert:()=>import_loader_utils19.assert,concatenateArrayBuffersAsync:()=>import_loader_utils20.concatenateArrayBuffersAsync,document:()=>import_loader_utils18.document,encode:()=>encode,encodeInBatches:()=>encodeInBatches,encodeSync:()=>encodeSync,encodeTable:()=>encodeTable,encodeTableAsText:()=>encodeTableAsText,encodeTableInBatches:()=>encodeTableInBatches,encodeText:()=>encodeText,encodeTextSync:()=>encodeTextSync,encodeURLtoURL:()=>encodeURLtoURL,fetchFile:()=>fetchFile,forEach:()=>import_loader_utils20.forEach,getLoaderOptions:()=>getGlobalLoaderOptions,getPathPrefix:()=>import_loader_utils15.getPathPrefix,global:()=>import_loader_utils18.global,isAsyncIterable:()=>isAsyncIterable,isBrowser:()=>import_loader_utils18.isBrowser,isIterable:()=>isIterable,isIterator:()=>isIterator,isPromise:()=>isPromise,isPureObject:()=>isPureObject,isReadableStream:()=>isReadableStream,isResponse:()=>isResponse,isWorker:()=>import_loader_utils18.isWorker,isWritableStream:()=>isWritableStream,load:()=>load,loadInBatches:()=>loadInBatches,makeIterator:()=>makeIterator,makeLineIterator:()=>import_loader_utils21.makeLineIterator,makeNumberedLineIterator:()=>import_loader_utils21.makeNumberedLineIterator,makeStream:()=>makeStream,makeTextDecoderIterator:()=>import_loader_utils21.makeTextDecoderIterator,makeTextEncoderIterator:()=>import_loader_utils21.makeTextEncoderIterator,parse:()=>parse,parseInBatches:()=>parseInBatches,parseSync:()=>parseSync,readArrayBuffer:()=>readArrayBuffer,registerLoaders:()=>registerLoaders,resolvePath:()=>import_loader_utils15.resolvePath,selectLoader:()=>selectLoader,selectLoaderSync:()=>selectLoaderSync,self:()=>import_loader_utils18.self,setLoaderOptions:()=>setGlobalOptions,setPathPrefix:()=>import_loader_utils15.setPathPrefix,window:()=>import_loader_utils18.window}),module.exports=__toCommonJS(src_exports);var import_loader_utils=require("@loaders.gl/loader-utils"),isBoolean=e=>"boolean"===typeof e,isFunction=e=>"function"===typeof e,isObject=e=>null!==e&&"object"===typeof e,isPureObject=e=>isObject(e)&&e.constructor==={}.constructor,isPromise=e=>isObject(e)&&isFunction(e.then),isIterable=e=>Boolean(e)&&"function"===typeof e[Symbol.iterator],isAsyncIterable=e=>e&&"function"===typeof e[Symbol.asyncIterator],isIterator=e=>e&&isFunction(e.next),isResponse=e=>"undefined"!==typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,isBlob=e=>"undefined"!==typeof Blob&&e instanceof Blob,isBuffer=e=>e&&"object"===typeof e&&e.isBuffer,isWritableDOMStream=e=>isObject(e)&&isFunction(e.abort)&&isFunction(e.getWriter),isReadableDOMStream=e=>"undefined"!==typeof ReadableStream&&e instanceof ReadableStream||isObject(e)&&isFunction(e.tee)&&isFunction(e.cancel)&&isFunction(e.getReader),isWritableNodeStream=e=>isObject(e)&&isFunction(e.end)&&isFunction(e.write)&&isBoolean(e.writable),isReadableNodeStream=e=>isObject(e)&&isFunction(e.read)&&isFunction(e.pipe)&&isBoolean(e.readable),isReadableStream=e=>isReadableDOMStream(e)||isReadableNodeStream(e),isWritableStream=e=>isWritableDOMStream(e)||isWritableNodeStream(e),DATA_URL_PATTERN=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,MIME_TYPE_PATTERN=/^([-\w.]+\/[-\w.+]+)/;function parseMIMEType(e){const r=MIME_TYPE_PATTERN.exec(e);return r?r[1]:e}function parseMIMETypeFromURL(e){const r=DATA_URL_PATTERN.exec(e);return r?r[1]:""}var QUERY_STRING_PATTERN=/\?.*/;function extractQueryString(e){const r=e.match(QUERY_STRING_PATTERN);return r&&r[0]}function stripQueryString(e){return e.replace(QUERY_STRING_PATTERN,"")}function getResourceUrl(e){if(isResponse(e)){return e.url}if(isBlob(e)){return e.name||""}return"string"===typeof e?e:""}function getResourceMIMEType(e){if(isResponse(e)){const r=e,t=r.headers.get("content-type")||"",o=stripQueryString(r.url);return parseMIMEType(t)||parseMIMETypeFromURL(o)}if(isBlob(e)){return e.type||""}return"string"===typeof e?parseMIMETypeFromURL(e):""}function getResourceContentLength(e){if(isResponse(e)){return e.headers["content-length"]||-1}if(isBlob(e)){return e.size}return"string"===typeof e?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}async function makeResponse(e){if(isResponse(e))return e;const r={},t=getResourceContentLength(e);t>=0&&(r["content-length"]=String(t));const o=getResourceUrl(e),n=getResourceMIMEType(e);n&&(r["content-type"]=n);const a=await getInitialDataUrl(e);a&&(r["x-first-bytes"]=a),"string"===typeof e&&(e=(new TextEncoder).encode(e));const i=new Response(e,{headers:r});return Object.defineProperty(i,"url",{value:o}),i}async function checkResponse(e){if(!e.ok){const r=await getResponseError(e);throw new Error(r)}}async function getResponseError(e){let r=`Failed to fetch resource ${e.url} (${e.status}): `;try{const t=e.headers.get("Content-Type");let o=e.statusText;(null==t?void 0:t.includes("application/json"))&&(o+=` ${await e.text()}`),r+=o,r=r.length>60?`${r.slice(0,60)}...`:r}catch(t){}return r}async function getInitialDataUrl(e){if("string"===typeof e)return`data:,${e.slice(0,5)}`;if(e instanceof Blob){const r=e.slice(0,5);return await new Promise((e=>{const t=new FileReader;t.onload=r=>{var t;return e(null==(t=null==r?void 0:r.target)?void 0:t.result)},t.readAsDataURL(r)}))}if(e instanceof ArrayBuffer){return`data:base64,${arrayBufferToBase64(e.slice(0,5))}`}return null}function arrayBufferToBase64(e){let r="";const t=new Uint8Array(e);for(let o=0;o<t.byteLength;o++)r+=String.fromCharCode(t[o]);return btoa(r)}function isNodePath(e){return!isRequestURL(e)&&!isDataURL(e)}function isRequestURL(e){return e.startsWith("http:")||e.startsWith("https:")}function isDataURL(e){return e.startsWith("data:")}async function fetchFile(e,r){var t,o;if("string"===typeof e){const n=(0,import_loader_utils.resolvePath)(e);return isNodePath(n)&&(null==(t=globalThis.loaders)?void 0:t.fetchNode)?null==(o=globalThis.loaders)?void 0:o.fetchNode(n,r):await fetch(n,r)}return await makeResponse(e)}async function readArrayBuffer(e,r,t){e instanceof Blob||(e=new Blob([e]));const o=e.slice(r,r+t);return await readBlob(o)}async function readBlob(e){return await new Promise(((r,t)=>{const o=new FileReader;o.onload=e=>{var t;return r(null==(t=null==e?void 0:e.target)?void 0:t.result)},o.onerror=e=>t(e),o.readAsArrayBuffer(e)}))}var import_log=require("@probe.gl/log"),probeLog=new import_log.Log({id:"loaders.gl"}),NullLog=class{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}},ConsoleLog=class{constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}},import_loader_utils2=require("@loaders.gl/loader-utils"),DEFAULT_LOADER_OPTIONS={fetch:null,mimeType:void 0,nothrow:!1,log:new ConsoleLog,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:import_loader_utils2.isBrowser,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},REMOVED_LOADER_OPTIONS={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function getGlobalLoaderState(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state=e._state||{},e._state}function getGlobalLoaderOptions(){const e=getGlobalLoaderState();return e.globalOptions=e.globalOptions||{...DEFAULT_LOADER_OPTIONS},e.globalOptions}function setGlobalOptions(e){const r=getGlobalLoaderState(),t=getGlobalLoaderOptions();r.globalOptions=normalizeOptionsInternal(t,e)}function normalizeOptions(e,r,t,o){return t=t||[],validateOptions(e,t=Array.isArray(t)?t:[t]),normalizeOptionsInternal(r,e,o)}function validateOptions(e,r){validateOptionsObject(e,null,DEFAULT_LOADER_OPTIONS,REMOVED_LOADER_OPTIONS,r);for(const t of r){const o=e&&e[t.id]||{},n=t.options&&t.options[t.id]||{},a=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};validateOptionsObject(o,t.id,n,a,r)}}function validateOptionsObject(e,r,t,o,n){const a=r||"Top level",i=r?`${r}.`:"";for(const s in e){const l=!r&&isObject(e[s]);if(!(s in t)&&!("baseUri"===s&&!r)&&!("workerUrl"===s&&r))if(s in o)probeLog.warn(`${a} loader option '${i}${s}' no longer supported, use '${o[s]}'`)();else if(!l){const e=findSimilarOption(s,n);probeLog.warn(`${a} loader option '${i}${s}' not recognized. ${e}`)()}}}function findSimilarOption(e,r){const t=e.toLowerCase();let o="";for(const n of r)for(const r in n.options){if(e===r)return`Did you mean '${n.id}.${r}'?`;const a=r.toLowerCase();(t.startsWith(a)||a.startsWith(t))&&(o=o||`Did you mean '${n.id}.${r}'?`)}return o}function normalizeOptionsInternal(e,r,t){const o={...e.options||{}};return addUrlOptions(o,t),null===o.log&&(o.log=new NullLog),mergeNestedFields(o,getGlobalLoaderOptions()),mergeNestedFields(o,r),o}function mergeNestedFields(e,r){for(const t in r)if(t in r){const o=r[t];isPureObject(o)&&isPureObject(e[t])?e[t]={...e[t],...r[t]}:e[t]=r[t]}}function addUrlOptions(e,r){r&&!("baseUri"in e)&&(e.baseUri=r)}var import_loader_utils3=require("@loaders.gl/loader-utils");function isLoaderObject(e){if(!e)return!1;Array.isArray(e)&&(e=e[0]);return Array.isArray(null==e?void 0:e.extensions)}function normalizeLoader(e){let r;return(0,import_loader_utils3.assert)(e,"null loader"),(0,import_loader_utils3.assert)(isLoaderObject(e),"invalid loader"),Array.isArray(e)&&(r=e[1],e=e[0],e={...e,options:{...e.options,...r}}),((null==e?void 0:e.parseTextSync)||(null==e?void 0:e.parseText))&&(e.text=!0),e.text||(e.binary=!0),e}var getGlobalLoaderRegistry=()=>{const e=getGlobalLoaderState();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};function registerLoaders(e){const r=getGlobalLoaderRegistry();e=Array.isArray(e)?e:[e];for(const t of e){const e=normalizeLoader(t);r.find((r=>e===r))||r.unshift(e)}}function getRegisteredLoaders(){return getGlobalLoaderRegistry()}function _unregisterLoaders(){getGlobalLoaderState().loaderRegistry=[]}var import_loader_utils4=require("@loaders.gl/loader-utils"),import_log2=require("@probe.gl/log"),log=new import_log2.Log({id:"loaders.gl"}),EXT_PATTERN=/\.([^.]+)$/;async function selectLoader(e,r=[],t,o){if(!validHTTPResponse(e))return null;let n=selectLoaderSync(e,r,{...t,nothrow:!0},o);if(n)return n;if(isBlob(e)&&(n=selectLoaderSync(e=await e.slice(0,10).arrayBuffer(),r,t,o)),!n&&!(null==t?void 0:t.nothrow))throw new Error(getNoValidLoaderMessage(e));return n}function selectLoaderSync(e,r=[],t,o){if(!validHTTPResponse(e))return null;if(r&&!Array.isArray(r))return normalizeLoader(r);let n=[];r&&(n=n.concat(r)),(null==t?void 0:t.ignoreRegisteredLoaders)||n.push(...getRegisteredLoaders()),normalizeLoaders(n);const a=selectLoaderInternal(e,n,t,o);if(!a&&!(null==t?void 0:t.nothrow))throw new Error(getNoValidLoaderMessage(e));return a}function selectLoaderInternal(e,r,t,o){const n=getResourceUrl(e),a=getResourceMIMEType(e),i=stripQueryString(n)||(null==o?void 0:o.url);let s=null,l="";return(null==t?void 0:t.mimeType)&&(s=findLoaderByMIMEType(r,null==t?void 0:t.mimeType),l=`match forced by supplied MIME type ${null==t?void 0:t.mimeType}`),s=s||findLoaderByUrl(r,i),l=l||(s?`matched url ${i}`:""),s=s||findLoaderByMIMEType(r,a),l=l||(s?`matched MIME type ${a}`:""),s=s||findLoaderByInitialBytes(r,e),l=l||(s?`matched initial data ${getFirstCharacters(e)}`:""),(null==t?void 0:t.fallbackMimeType)&&(s=s||findLoaderByMIMEType(r,null==t?void 0:t.fallbackMimeType),l=l||(s?`matched fallback MIME type ${a}`:"")),l&&log.log(1,`selectLoader selected ${null==s?void 0:s.name}: ${l}.`),s}function validHTTPResponse(e){return!(e instanceof Response&&204===e.status)}function getNoValidLoaderMessage(e){const r=getResourceUrl(e),t=getResourceMIMEType(e);let o="No valid loader found (";o+=r?`${import_loader_utils4.path.filename(r)}, `:"no url provided, ",o+=`MIME type: ${t?`"${t}"`:"not provided"}, `;const n=e?getFirstCharacters(e):"";return o+=n?` first bytes: "${n}"`:"first bytes: not available",o+=")",o}function normalizeLoaders(e){for(const r of e)normalizeLoader(r)}function findLoaderByUrl(e,r){const t=r&&EXT_PATTERN.exec(r),o=t&&t[1];return o?findLoaderByExtension(e,o):null}function findLoaderByExtension(e,r){r=r.toLowerCase();for(const t of e)for(const e of t.extensions)if(e.toLowerCase()===r)return t;return null}function findLoaderByMIMEType(e,r){for(const t of e){if(t.mimeTypes&&t.mimeTypes.includes(r))return t;if(r===`application/x.${t.id}`)return t}return null}function findLoaderByInitialBytes(e,r){if(!r)return null;for(const t of e)if("string"===typeof r){if(testDataAgainstText(r,t))return t}else if(ArrayBuffer.isView(r)){if(testDataAgainstBinary(r.buffer,r.byteOffset,t))return t}else if(r instanceof ArrayBuffer){if(testDataAgainstBinary(r,0,t))return t}return null}function testDataAgainstText(e,r){if(r.testText)return r.testText(e);return(Array.isArray(r.tests)?r.tests:[r.tests]).some((r=>e.startsWith(r)))}function testDataAgainstBinary(e,r,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some((o=>testBinary(e,r,t,o)))}function testBinary(e,r,t,o){if(o instanceof ArrayBuffer)return(0,import_loader_utils4.compareArrayBuffers)(o,e,o.byteLength);switch(typeof o){case"function":return o(e);case"string":return o===getMagicString(e,r,o.length);default:return!1}}function getFirstCharacters(e,r=5){if("string"===typeof e)return e.slice(0,r);if(ArrayBuffer.isView(e))return getMagicString(e.buffer,e.byteOffset,r);if(e instanceof ArrayBuffer){return getMagicString(e,0,r)}return""}function getMagicString(e,r,t){if(e.byteLength<r+t)return"";const o=new DataView(e);let n="";for(let a=0;a<t;a++)n+=String.fromCharCode(o.getUint8(r+a));return n}var import_loader_utils8=require("@loaders.gl/loader-utils"),import_worker_utils=require("@loaders.gl/worker-utils"),import_loader_utils9=require("@loaders.gl/loader-utils"),import_loader_utils6=require("@loaders.gl/loader-utils"),DEFAULT_CHUNK_SIZE=262144;function*makeStringIterator(e,r){const t=(null==r?void 0:r.chunkSize)||DEFAULT_CHUNK_SIZE;let o=0;const n=new TextEncoder;for(;o<e.length;){const r=Math.min(e.length-o,t),a=e.slice(o,o+r);o+=r,yield n.encode(a)}}var DEFAULT_CHUNK_SIZE2=262144;function*makeArrayBufferIterator(e,r={}){const{chunkSize:t=DEFAULT_CHUNK_SIZE2}=r;let o=0;for(;o<e.byteLength;){const r=Math.min(e.byteLength-o,t),n=new ArrayBuffer(r),a=new Uint8Array(e,o,r);new Uint8Array(n).set(a),o+=r,yield n}}var DEFAULT_CHUNK_SIZE3=1048576;async function*makeBlobIterator(e,r){const t=(null==r?void 0:r.chunkSize)||DEFAULT_CHUNK_SIZE3;let o=0;for(;o<e.size;){const r=o+t,n=await e.slice(o,r).arrayBuffer();o=r,yield n}}var import_loader_utils5=require("@loaders.gl/loader-utils");function makeStreamIterator(e,r){return import_loader_utils5.isBrowser?makeBrowserStreamIterator(e,r):makeNodeStreamIterator(e,r)}async function*makeBrowserStreamIterator(e,r){const t=e.getReader();let o;try{for(;;){const e=o||t.read();(null==r?void 0:r._streamReadAhead)&&(o=t.read());const{done:n,value:a}=await e;if(n)return;yield(0,import_loader_utils5.toArrayBuffer)(a)}}catch(n){t.releaseLock()}}async function*makeNodeStreamIterator(e,r){for await(const t of e)yield(0,import_loader_utils5.toArrayBuffer)(t)}function makeIterator(e,r){if("string"===typeof e)return makeStringIterator(e,r);if(e instanceof ArrayBuffer)return makeArrayBufferIterator(e,r);if(isBlob(e))return makeBlobIterator(e,r);if(isReadableStream(e))return makeStreamIterator(e,r);if(isResponse(e)){return makeStreamIterator(e.body,r)}throw new Error("makeIterator")}var ERR_DATA="Cannot convert supplied data type";function getArrayBufferOrStringFromDataSync(e,r,t){if(r.text&&"string"===typeof e)return e;if(isBuffer(e)&&(e=e.buffer),e instanceof ArrayBuffer){const t=e;if(r.text&&!r.binary){return new TextDecoder("utf8").decode(t)}return t}if(ArrayBuffer.isView(e)){if(r.text&&!r.binary){return new TextDecoder("utf8").decode(e)}let t=e.buffer;const o=e.byteLength||e.length;return 0===e.byteOffset&&o===t.byteLength||(t=t.slice(e.byteOffset,e.byteOffset+o)),t}throw new Error(ERR_DATA)}async function getArrayBufferOrStringFromData(e,r,t){const o=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if("string"===typeof e||o)return getArrayBufferOrStringFromDataSync(e,r,t);if(isBlob(e)&&(e=await makeResponse(e)),isResponse(e)){const t=e;return await checkResponse(t),r.binary?await t.arrayBuffer():await t.text()}if(isReadableStream(e)&&(e=makeIterator(e,t)),isIterable(e)||isAsyncIterable(e))return(0,import_loader_utils6.concatenateArrayBuffersAsync)(e);throw new Error(ERR_DATA)}async function getAsyncIterableFromData(e,r){if(isIterator(e))return e;if(isResponse(e)){const t=e;await checkResponse(t);return makeIterator(await t.body,r)}return isBlob(e)||isReadableStream(e)?makeIterator(e,r):isAsyncIterable(e)?e:getIterableFromData(e)}function getIterableFromData(e){if(ArrayBuffer.isView(e))return function*(){yield e.buffer}();if(e instanceof ArrayBuffer)return function*(){yield e}();if(isIterator(e))return e;if(isIterable(e))return e[Symbol.iterator]();throw new Error(ERR_DATA)}function getFetchFunction(e,r){const t=getGlobalLoaderOptions(),o=e||t;return"function"===typeof o.fetch?o.fetch:isObject(o.fetch)?e=>fetchFile(e,o.fetch):(null==r?void 0:r.fetch)?null==r?void 0:r.fetch:fetchFile}var import_loader_utils7=require("@loaders.gl/loader-utils");function getLoaderContext(e,r,t){if(t)return t;const o={fetch:getFetchFunction(r,e),...e};if(o.url){const e=stripQueryString(o.url);o.baseUrl=e,o.queryString=extractQueryString(o.url),o.filename=import_loader_utils7.path.filename(e),o.baseUrl=import_loader_utils7.path.dirname(e)}return Array.isArray(o.loaders)||(o.loaders=null),o}function getLoadersFromContext(e,r){if(e&&!Array.isArray(e))return e;let t;if(e&&(t=Array.isArray(e)?e:[e]),r&&r.loaders){const e=Array.isArray(r.loaders)?r.loaders:[r.loaders];t=t?[...t,...e]:e}return t&&t.length?t:void 0}async function parse(e,r,t,o){!r||Array.isArray(r)||isLoaderObject(r)||(o=void 0,t=r,r=void 0),t=t||{};const n=getResourceUrl(e=await e),a=getLoadersFromContext(r,o),i=await selectLoader(e,a,t);return i?(o=getLoaderContext({url:n,_parse:parse,loaders:a},t=normalizeOptions(t,i,a,n),o||null),await parseWithLoader(i,e,t,o)):null}async function parseWithLoader(e,r,t,o){if((0,import_worker_utils.validateWorkerVersion)(e),t=(0,import_loader_utils9.mergeLoaderOptions)(e.options,t),isResponse(r)){const e=r,{ok:t,redirected:n,status:a,statusText:i,type:s,url:l}=e,c=Object.fromEntries(e.headers.entries());o.response={headers:c,ok:t,redirected:n,status:a,statusText:i,type:s,url:l}}r=await getArrayBufferOrStringFromData(r,e,t);const n=e;if(n.parseTextSync&&"string"===typeof r)return n.parseTextSync(r,t,o);if((0,import_loader_utils8.canParseWithWorker)(e,t))return await(0,import_loader_utils8.parseWithWorker)(e,r,t,o,parse);if(n.parseText&&"string"===typeof r)return await n.parseText(r,t,o);if(n.parse)return await n.parse(r,t,o);throw(0,import_worker_utils.assert)(!n.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}function parseSync(e,r,t,o){Array.isArray(r)||isLoaderObject(r)||(o=void 0,t=r,r=void 0),t=t||{};const n=getLoadersFromContext(r,o),a=selectLoaderSync(e,n,t);if(!a)return null;const i=()=>{throw new Error("parseSync called parse (which is async")};return parseWithLoaderSync(a,e,t=normalizeOptions(t,a,n),o=getLoaderContext({url:getResourceUrl(e),_parseSync:i,_parse:i,loaders:r},t,o||null))}function parseWithLoaderSync(e,r,t,o){if(r=getArrayBufferOrStringFromDataSync(r,e,t),e.parseTextSync&&"string"===typeof r)return e.parseTextSync(r,t);if(e.parseSync&&r instanceof ArrayBuffer)return e.parseSync(r,t,o);throw new Error(`${e.name} loader: 'parseSync' not supported by this loader, use 'parse' instead. ${o.url||""}`)}var import_schema=require("@loaders.gl/schema"),import_loader_utils10=require("@loaders.gl/loader-utils");async function parseInBatches(e,r,t,o){const n=Array.isArray(r)?r:void 0;Array.isArray(r)||isLoaderObject(r)||(o=void 0,t=r,r=void 0),t=t||{};const a=getResourceUrl(e=await e),i=await selectLoader(e,r,t);return i?(o=getLoaderContext({url:a,_parseInBatches:parseInBatches,_parse:parse,loaders:n},t=normalizeOptions(t,i,n,a),o||null),await parseWithLoaderInBatches(i,e,t,o)):[]}async function parseWithLoaderInBatches(e,r,t,o){const n=await parseToOutputIterator(e,r,t,o);if(!t.metadata)return n;const a={shape:"metadata",batchType:"metadata",metadata:{_loader:e,_context:o},data:[],bytesUsed:0};return async function*(e){yield a,yield*e}(n)}async function parseToOutputIterator(e,r,t,o){const n=await getAsyncIterableFromData(r,t),a=await applyInputTransforms(n,(null==t?void 0:t.transforms)||[]);return e.parseInBatches?e.parseInBatches(a,t,o):parseChunkInBatches(a,e,t,o)}async function*parseChunkInBatches(e,r,t,o){const n=await(0,import_loader_utils10.concatenateArrayBuffersAsync)(e),a=convertDataToBatch(await parse(n,r,{...t,mimeType:r.mimeTypes[0]},o),r);yield a}function convertDataToBatch(e,r){const t=(0,import_schema.isTable)(e)?(0,import_schema.makeBatchFromTable)(e):{shape:"unknown",batchType:"data",data:e,length:Array.isArray(e)?e.length:1};return t.mimeType=r.mimeTypes[0],t}async function applyInputTransforms(e,r=[]){let t=e;for await(const o of r)t=o(t);return t}async function load(e,r,t,o){let n,a;Array.isArray(r)||isLoaderObject(r)?(n=r,a=t):(n=[],a=r);const i=getFetchFunction(a);let s=e;return"string"===typeof e&&(s=await i(e)),isBlob(e)&&(s=await i(e)),Array.isArray(n),await parse(s,n,a)}function loadInBatches(e,r,t,o){let n;Array.isArray(r)||isLoaderObject(r)?n=r:(void 0,t=r,n=void 0);const a=getFetchFunction(t||{});if(!Array.isArray(e))return loadOneFileInBatches(e,n,t||{},a);return e.map((e=>loadOneFileInBatches(e,n,t||{},a)))}async function loadOneFileInBatches(e,r,t,o){if("string"===typeof e){const n=e,a=await o(n);return Array.isArray(r),await parseInBatches(a,r,t)}return Array.isArray(r),await parseInBatches(e,r,t)}var import_loader_utils11=require("@loaders.gl/loader-utils");async function encodeTable(e,r,t){if(r.encode)return await r.encode(e,t);if(r.encodeText){const o=await r.encodeText(e,t);return(new TextEncoder).encode(o)}if(r.encodeInBatches){const o=encodeTableInBatches(e,r,t),n=[];for await(const e of o)n.push(e);return(0,import_loader_utils11.concatenateArrayBuffers)(...n)}throw new Error("Writer could not encode data")}async function encodeTableAsText(e,r,t){if(r.text&&r.encodeText)return await r.encodeText(e,t);if(r.text){const o=await encodeTable(e,r,t);return(new TextDecoder).decode(o)}throw new Error(`Writer ${r.name} could not encode data as text`)}function encodeTableInBatches(e,r,t){if(r.encodeInBatches){const o=getIterator(e);return r.encodeInBatches(o,t)}throw new Error("Writer could not encode data in batches")}function getIterator(e){return[{...e,start:0,end:e.length}]}var import_loader_utils12=require("@loaders.gl/loader-utils"),import_worker_utils2=require("@loaders.gl/worker-utils"),import_loader_utils13=require("@loaders.gl/loader-utils");async function encode(e,r,t){return t={...getGlobalLoaderOptions(),...t},r.encodeURLtoURL?encodeWithCommandLineTool(r,e,t):(0,import_loader_utils12.canEncodeWithWorker)(r,t)?await(0,import_worker_utils2.processOnWorker)(r,e,t):await r.encode(e,t)}function encodeSync(e,r,t){if(r.encodeSync)return r.encodeSync(e,t);if(r.encodeTextSync)return(new TextEncoder).encode(r.encodeTextSync(e,t));throw new Error(`Writer ${r.name} could not synchronously encode data`)}async function encodeText(e,r,t){if(r.encodeText)return await r.encodeText(e,t);if(r.encodeTextSync)return r.encodeTextSync(e,t);if(r.text){const o=await r.encode(e,t);return(new TextDecoder).decode(o)}throw new Error(`Writer ${r.name} could not encode data as text`)}function encodeTextSync(e,r,t){if(r.encodeTextSync)return r.encodeTextSync(e,t);if(r.text&&r.encodeSync){const o=encodeSync(e,r,t);return(new TextDecoder).decode(o)}throw new Error(`Writer ${r.name} could not encode data as text`)}function encodeInBatches(e,r,t){if(r.encodeInBatches){const o=getIterator2(e);return r.encodeInBatches(o,t)}throw new Error(`Writer ${r.name} could not encode in batches`)}async function encodeURLtoURL(e,r,t,o){if(e=(0,import_loader_utils12.resolvePath)(e),r=(0,import_loader_utils12.resolvePath)(r),import_loader_utils13.isBrowser||!t.encodeURLtoURL)throw new Error;return await t.encodeURLtoURL(e,r,o)}async function encodeWithCommandLineTool(e,r,t){if(import_loader_utils13.isBrowser)throw new Error(`Writer ${e.name} not supported in browser`);const o=getTemporaryFilename("input"),n=new import_loader_utils12.NodeFile(o,"w");await n.write(r);const a=getTemporaryFilename("output"),i=await encodeURLtoURL(o,a,e,t);return(await fetchFile(i)).arrayBuffer()}function getIterator2(e){return[{...e,start:0,end:e.length}]}function getTemporaryFilename(e){return`/tmp/${e}`}var import_loader_utils15=require("@loaders.gl/loader-utils"),import_loader_utils16=require("@loaders.gl/loader-utils");function makeStream(e,r){if(globalThis.loaders.makeNodeStream)return globalThis.loaders.makeNodeStream(e,r);const t=e[Symbol.asyncIterator]?e[Symbol.asyncIterator]():e[Symbol.iterator]();return new ReadableStream({type:"bytes",async pull(e){try{const{done:r,value:o}=await t.next();r?e.close():e.enqueue(new Uint8Array(o))}catch(r){e.error(r)}},async cancel(){var e;await(null==(e=null==t?void 0:t.return)?void 0:e.call(t))}},{highWaterMark:2**24,...r})}var VERSION="undefined"!==typeof __VERSION__?__VERSION__:"latest",NullWorkerLoader={name:"Null loader",id:"null",module:"core",version:VERSION,worker:!0,mimeTypes:["application/x.empty"],extensions:["null"],tests:[()=>!1],options:{null:{}}},NullLoader={name:"Null loader",id:"null",module:"core",version:VERSION,mimeTypes:["application/x.empty"],extensions:["null"],parse:async(e,r,t)=>parseSync2(e,r||{},t),parseSync:parseSync2,parseInBatches:async function*(e,r,t){for await(const o of e)yield parseSync2(o,r,t)},tests:[()=>!1],options:{null:{}}};function parseSync2(e,r,t){return null}var import_loader_utils17=require("@loaders.gl/loader-utils");async function fetchProgress(e,r,t=(()=>{}),o=(()=>{})){if(!(e=await e).ok)return e;const n=e.body;if(!n)return e;const a=e.headers.get("content-length")||0,i=a?parseInt(a):0;if(!(i>0))return e;if("undefined"===typeof ReadableStream||!n.getReader)return e;const s=new ReadableStream({async start(e){const a=n.getReader();await read(e,a,0,i,r,t,o)}});return new Response(s)}async function read(e,r,t,o,n,a,i){try{const{done:s,value:l}=await r.read();if(s)return a(),void e.close();t+=l.byteLength;n(Math.round(t/o*100),{loadedBytes:t,totalBytes:o}),e.enqueue(l),await read(e,r,t,o,n,a,i)}catch(s){e.error(s),i(s)}}var import_loader_utils14=require("@loaders.gl/loader-utils"),BrowserFileSystem=class{constructor(e,r){this.files={},this.lowerCaseFiles={},this.usedFiles={},this._fetch=(null==r?void 0:r.fetch)||fetch;for(let t=0;t<e.length;++t){const r=e[t];this.files[r.name]=r,this.lowerCaseFiles[r.name.toLowerCase()]=r,this.usedFiles[r.name]=!1}this.fetch=this.fetch.bind(this)}async fetch(e,r){if(e.includes("://"))return this._fetch(e,r);const t=this.files[e];if(!t)return new Response(e,{status:400,statusText:"NOT FOUND"});const o=new Headers(null==r?void 0:r.headers).get("Range"),n=o&&/bytes=($1)-($2)/.exec(o);if(n){const r=parseInt(n[1]),o=parseInt(n[2]),a=await t.slice(r,o).arrayBuffer(),i=new Response(a);return Object.defineProperty(i,"url",{value:e}),i}const a=new Response(t);return Object.defineProperty(a,"url",{value:e}),a}async readdir(e){const r=[];for(const t in this.files)r.push(t);return r}async stat(e,r){const t=this.files[e];if(!t)throw new Error(e);return{size:t.size}}async unlink(e){delete this.files[e],delete this.lowerCaseFiles[e],this.usedFiles[e]=!0}async openReadableFile(e,r){return new import_loader_utils14.BlobFile(this.files[e])}_getFile(e,r){const t=this.files[e]||this.lowerCaseFiles[e];return t&&r&&(this.usedFiles[e]=!0),t}},import_loader_utils18=require("@loaders.gl/loader-utils"),import_loader_utils19=require("@loaders.gl/loader-utils"),import_loader_utils20=require("@loaders.gl/loader-utils"),import_loader_utils21=require("@loaders.gl/loader-utils");